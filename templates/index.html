<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>System Metrics</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div>
        <h1 style="color: red;">SMA</h1>
    </div>

    <div id="dashboard">
        
        <div class="section" id="cpu-section">
            <h2>CPU</h2>
            <div>Usage: <span id="cpu-usage">Loading...</span>%</div>
            <div>Physical Count: <span id="cpu-physical-count">Loading...</span></div>
            <div>Logical Count: <span id="cpu-logical-count">Loading...</span></div>
            <div>Speed: <span id="cpu-speed">Loading...</span> GHz</div>
            <div>Up-time: <span id="cpu-uptime">Loading...</span></div>
        </div>        
        <div class="section" id="memory-section">
            <h2>Memory</h2>
            <div>Total Available: <span id="total-memory">Loading...</span></div>
            <div>Used: <span id="used-memory">Loading...</span></div>
        </div>        
        <div class="section" id="disk-section">
            <h2>Disk</h2>
            <div>Disk Usage: <span id="disk-usage">Loading...</span>%</div>
        </div>
        <div class="section" id="process-section">
            <h2>Process</h2>
            <div>CPU Usage: <span id="cpu-usage">Loading...</span>%</div>
        </div>
    </div>


    <script>
        let countdownInterval;
        
        function updateSystemMetrics() {
            fetch('/api/system_metrics')  // Updated URL
                .then(response => response.json())
                .then(data => {
                    // Update DOM elements with fetched data
                    document.getElementById('cpu-usage').textContent = data.cpu_usage.percent.toFixed(1);
                    document.getElementById('cpu-physical-count').textContent = data.cpu_usage.physical_count;
                    document.getElementById('cpu-logical-count').textContent = data.cpu_usage.logical_count;
                    document.getElementById('cpu-speed').textContent = data.cpu_usage.speed + " GHz";
                    document.getElementById('cpu-uptime').textContent = data.cpu_usage.uptime;

                    document.getElementById('total-memory').textContent = data.memory_info.total + ' GB';
                    document.getElementById('used-memory').textContent = data.memory_info.used + ' GB';
                    document.getElementById('memory-percent').textContent = data.memory_info.percent + '%';
                    resetCountdown(30);
                })
                .catch(error => console.error('Error fetching system metrics:', error));
        }

        
        function resetCountdown(seconds) {
            clearInterval(countdownInterval); // Clear existing interval
            const countdownElement = document.getElementById('countdown');
            countdownElement.textContent = seconds;
        
            countdownInterval = setInterval(() => {
                seconds--;
                countdownElement.textContent = seconds;
                if (seconds <= 0) {
                    updateSystemMetrics(); // Fetch and update system metrics
                    resetCountdown(30);
                }
            }, 1000);
        }
        
        // Initial update and countdown reset
        updateSystemMetrics();
    </script>
    
    
</body>
</html>
